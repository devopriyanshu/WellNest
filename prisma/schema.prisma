generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================
// CENTRAL AUTHENTICATION
// ============================================

model CentralUser {
  id         Int       @id @default(autoincrement())
  email      String    @unique @db.VarChar(100)
  password   String?   @db.VarChar(255)
  role       String    @default("user") @db.VarChar(30)
  status     String?   @default("active") @db.VarChar(20)
  googleId   String?   @unique @map("google_id") @db.VarChar(255)
  isVerified Boolean   @default(false) @map("is_verified")
  isActive   Boolean   @default(true) @map("is_active")
  lastLogin  DateTime? @map("last_login") @db.Timestamp(6)
  createdAt  DateTime? @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt  DateTime? @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)
  name       String?   @db.VarChar(50)
  provider   String?   @default("local")

  // Relations
  users         User[]
  experts       Expert[]
  centers       Center[]
  admins        Admin[]
  refreshTokens RefreshToken[]
  auditLogs     AuditLog[]

  @@map("central_users")
}

model RefreshToken {
  id            Int      @id @default(autoincrement())
  token         String   @unique @db.VarChar(500)
  centralUserId Int      @map("central_user_id")
  expiresAt     DateTime @map("expires_at") @db.Timestamp(6)
  createdAt     DateTime @default(now()) @map("created_at") @db.Timestamp(6)

  centralUser CentralUser @relation(fields: [centralUserId], references: [id], onDelete: Cascade)

  @@index([centralUserId])
  @@map("refresh_tokens")
}

// ============================================
// USER PROFILES
// ============================================

model User {
  id                 Int       @id @default(autoincrement())
  fullName           String    @map("full_name") @db.VarChar(255)
  email              String?   @db.VarChar(100)
  phoneNumber        String?   @map("phone_number") @db.VarChar(20)
  gender             String?   @db.VarChar(10)
  dob                DateTime? @db.Date
  createdAt          DateTime? @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt          DateTime? @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)
  is_active          Boolean?  @default(true)
  role               String?   @default("user") @db.VarChar(50)
  last_login         DateTime? @db.Timestamp(6)
  profilePicture     String?   @map("profile_picture") @db.VarChar(255)
  address            String?
  languagePreference String?   @map("language_preference") @db.VarChar(50)
  deleted_at         DateTime? @db.Timestamp(6)
  height             Decimal?  @db.Decimal(5, 2)
  weight             Decimal?  @db.Decimal(5, 2)
  user_id            Int?

  // Relations
  centralUser               CentralUser?                @relation(fields: [user_id], references: [id], onDelete: Cascade)
  activityLogs              ActivityLog[]
  appointments              Appointment[]
  mealLogs                  MealLog[]
  mental_health_assessments mental_health_assessments[]
  mood_logs                 mood_logs[]
  payments                  payments[]
  sleepLogs                 SleepLog[]
  stress_logs               stress_logs[]
  reviews                   Review[]

  @@map("users")
}

model Expert {
  id            Int       @id @default(autoincrement())
  name          String    @db.VarChar(255)
  email         String    @unique @db.VarChar(255)
  phone         String?   @unique @db.VarChar(20)
  category      String?   @db.VarChar(255)
  bio           String?
  profile_image String?
  createdAt     DateTime? @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt     DateTime? @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)
  bg_image      String?
  website       String?
  location      String?
  languages     String[]
  experience    String?   @db.VarChar(100)
  user_id       Int?
  status        String    @default("pending") @db.VarChar(20)
  isApproved    Boolean   @default(false) @map("is_approved")
  isVerified    Boolean   @default(false) @map("is_verified")
  rating        Decimal?  @default(0) @db.Decimal(3, 2)
  totalReviews  Int       @default(0) @map("total_reviews")

  // Relations
  centralUser           CentralUser?            @relation(fields: [user_id], references: [id], onDelete: Cascade)
  appointments          Appointment[]
  availability          ExpertAvailability[]
  expert_faqs           expert_faqs[]
  expert_qualifications expert_qualifications[]
  expert_services       expert_services[]
  expert_specialties    expert_specialties[]
  payments              payments[]
  reviews               Review[]

  @@index([user_id])
  @@index([status])
  @@map("experts")
}

model ExpertAvailability {
  id        Int       @id @default(autoincrement())
  expertId  Int?      @map("expert_id")
  day       String?   @db.VarChar(20)
  selected  Boolean?
  startTime DateTime? @map("start_time") @db.Time(6)
  endTime   DateTime? @map("end_time") @db.Time(6)

  expert Expert? @relation(fields: [expertId], references: [id], onDelete: Cascade)

  @@index([expertId])
  @@map("expert_availability")
}

model Center {
  id           Int       @id @default(autoincrement())
  name         String?   @db.VarChar(255)
  category     String?   @db.VarChar(100)
  description  String?
  address      String?
  phone        String?   @db.VarChar(20)
  email        String?   @unique(map: "unique_email") @db.VarChar(100)
  website      String?   @db.VarChar(255)
  createdAt    DateTime? @default(now()) @map("created_at") @db.Timestamp(6)
  offers       String?
  user_id      Int?
  latitude     Decimal?  @db.Decimal(10, 7)
  longitude    Decimal?  @db.Decimal(11, 7)
  centerImage  String?   @map("center_image")
  status       String    @default("pending") @db.VarChar(20)
  isApproved   Boolean   @default(false) @map("is_approved")
  isVerified   Boolean   @default(false) @map("is_verified")
  rating       Decimal?  @default(0) @db.Decimal(3, 2)
  totalReviews Int       @default(0) @map("total_reviews")

  // Relations
  centralUser      CentralUser?       @relation(fields: [user_id], references: [id], onDelete: Cascade)
  center_addresses center_addresses[]
  center_amenities center_amenities[]
  center_classes   center_classes[]
  center_equipment center_equipment[]
  center_faqs      center_faqs[]
  center_images    center_images[]
  center_pricing   center_pricing[]
  center_reviews   center_reviews[]
  center_schedule  center_schedule[]
  center_services  center_services[]
  center_trainers  center_trainers[]
  schedules        schedules[]

  @@index([user_id])
  @@index([status])
  @@map("centers")
}

model Admin {
  id            Int      @id @default(autoincrement())
  centralUserId Int      @unique @map("central_user_id")
  fullName      String   @map("full_name") @db.VarChar(255)
  phoneNumber   String?  @map("phone_number") @db.VarChar(20)
  department    String?  @db.VarChar(100)
  permissions   String[]
  createdAt     DateTime @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt     DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)

  centralUser CentralUser @relation(fields: [centralUserId], references: [id], onDelete: Cascade)

  @@index([centralUserId])
  @@map("admins")
}

// ============================================
// APPOINTMENTS
// ============================================

model Appointment {
  id              Int       @id @default(autoincrement())
  userId          Int       @map("user_id")
  expertId        Int       @map("expert_id")
  appointmentDate DateTime  @map("appointment_date") @db.Timestamp(6)
  type            String?   @db.VarChar(50)
  status          String?   @default("pending") @db.VarChar(50)
  notes           String?
  createdAt       DateTime? @default(now()) @map("created_at") @db.Timestamp(6)

  // Relations
  expert Expert  @relation(fields: [expertId], references: [id], onDelete: Cascade)
  user   User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  review Review?

  @@index([userId])
  @@index([expertId])
  @@index([appointmentDate])
  @@index([status])
  @@map("appointments")
}

// ============================================
// HEALTH TRACKING
// ============================================

model SleepLog {
  id        Int       @id @default(autoincrement())
  userId    Int?      @map("user_id")
  date      DateTime  @db.Date
  hours     Decimal?  @db.Decimal(4, 2)
  quality   String?   @db.VarChar(100)
  notes     String?
  createdAt DateTime? @default(now()) @map("created_at") @db.Timestamp(6)

  user User? @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, date])
  @@map("sleep_logs")
}

model ActivityLog {
  id         Int       @id @default(autoincrement())
  userId     Int?      @map("user_id")
  activities String
  date       DateTime? @default(now()) @db.Date
  duration   Decimal?  @db.Decimal(5, 2)
  calories   Int?
  notes      String?

  user User? @relation(fields: [userId], references: [id])

  @@index([userId, date])
  @@map("activity_logs")
}

model MealLog {
  id        Int       @id @default(autoincrement())
  userId    Int?      @map("user_id")
  name      String    @db.VarChar(100)
  date      DateTime  @db.Date
  time      DateTime  @db.Time(6)
  calories  Int?
  protein   Int?
  carbs     Int?
  fat       Int?
  createdAt DateTime? @default(now()) @map("created_at") @db.Timestamp(6)

  user User? @relation(fields: [userId], references: [id])

  @@index([userId, date])
  @@map("meal_logs")
}

// ============================================
// REVIEWS & RATINGS
// ============================================

model Review {
  id            Int      @id @default(autoincrement())
  userId        Int      @map("user_id")
  expertId      Int      @map("expert_id")
  appointmentId Int      @unique @map("appointment_id")
  rating        Int      @db.SmallInt
  reviewText    String?  @map("review_text") @db.Text
  responseText  String?  @map("response_text") @db.Text
  isVerified    Boolean  @default(false) @map("is_verified")
  createdAt     DateTime @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt     DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)

  user        User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  expert      Expert      @relation(fields: [expertId], references: [id], onDelete: Cascade)
  appointment Appointment @relation(fields: [appointmentId], references: [id], onDelete: Cascade)

  @@index([expertId])
  @@index([userId])
  @@map("reviews")
}

// ============================================
// AUDIT & SECURITY
// ============================================

model AuditLog {
  id            Int      @id @default(autoincrement())
  centralUserId Int      @map("central_user_id")
  action        String   @db.VarChar(100)
  resource      String   @db.VarChar(100)
  resourceId    Int?     @map("resource_id")
  ipAddress     String?  @map("ip_address") @db.VarChar(45)
  userAgent     String?  @map("user_agent") @db.Text
  metadata      Json?
  createdAt     DateTime @default(now()) @map("created_at") @db.Timestamp(6)

  centralUser CentralUser @relation(fields: [centralUserId], references: [id], onDelete: Cascade)

  @@index([centralUserId])
  @@index([action])
  @@index([createdAt])
  @@map("audit_logs")
}

// ============================================
// MENTAL HEALTH & WELLNESS
// ============================================

model mental_health_assessments {
  id                        Int       @id @default(autoincrement())
  user_id                   Int?
  assessment_type           String?   @db.VarChar(100)
  assessment_subtype        String?   @db.VarChar(100)
  score                     Int?
  assessment_date           DateTime? @db.Timestamp(6)
  result                    String?
  symptoms                  String?
  mood_before_assessment    String?   @db.VarChar(20)
  assessment_duration       Int?
  follow_up_recommendations String?
  assessment_feedback       String?
  created_at                DateTime? @default(now()) @db.Timestamp(6)
  updated_at                DateTime? @default(now()) @db.Timestamp(6)

  users User? @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id])
}

model mood_logs {
  id               Int       @id @default(autoincrement())
  user_id          Int?
  mood_rating      Int?
  mood_description String?
  log_time         DateTime? @default(now()) @db.Timestamp(6)
  location         String?   @db.VarChar(255)
  mood_type        String?   @db.VarChar(50)
  created_at       DateTime? @default(now()) @db.Timestamp(6)
  updated_at       DateTime? @default(now()) @db.Timestamp(6)

  users User? @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id])
}

model stress_logs {
  id                Int       @id @default(autoincrement())
  user_id           Int?
  stress_level      Int?
  symptoms          String?
  stressors         String?
  stress_type       String?   @db.VarChar(50)
  duration          Int?
  coping_mechanisms String?
  mood_at_time      String?   @db.VarChar(20)
  location          String?   @db.VarChar(255)
  log_time          DateTime? @default(now()) @db.Timestamp(6)
  created_at        DateTime? @default(now()) @db.Timestamp(6)
  updated_at        DateTime? @default(now()) @db.Timestamp(6)

  users User? @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id])
}

// ============================================
// PAYMENTS
// ============================================

model payments {
  id             Int       @id @default(autoincrement())
  user_id        Int?
  expert_id      Int?
  appointment_id Int?
  amount         Decimal   @db.Decimal(10, 2)
  payment_status String?   @default("pending") @db.VarChar(50)
  payment_method String?   @db.VarChar(50)
  created_at     DateTime? @default(now()) @db.Timestamp(6)

  expert Expert? @relation(fields: [expert_id], references: [id], onDelete: Cascade)
  user   User?   @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id])
  @@index([expert_id])
}

// ============================================
// EXPERT SUPPORTING TABLES
// ============================================

model expert_faqs {
  id        Int     @id @default(autoincrement())
  expert_id Int?
  question  String?
  answer    String?

  expert Expert? @relation(fields: [expert_id], references: [id], onDelete: Cascade)

  @@index([expert_id])
}

model expert_qualifications {
  id        Int     @id @default(autoincrement())
  expert_id Int?
  value     String? @db.VarChar(255)

  expert Expert? @relation(fields: [expert_id], references: [id], onDelete: Cascade)

  @@index([expert_id])
}

model expert_services {
  id        Int      @id @default(autoincrement())
  expert_id Int?
  name      String?  @db.VarChar(100)
  format    String?  @db.VarChar(50)
  duration  Int?
  price     Decimal? @db.Decimal(10, 2)

  expert Expert? @relation(fields: [expert_id], references: [id], onDelete: Cascade)

  @@index([expert_id])
}

model expert_specialties {
  id        Int     @id @default(autoincrement())
  expert_id Int?
  value     String? @db.VarChar(255)

  expert Expert? @relation(fields: [expert_id], references: [id], onDelete: Cascade)

  @@index([expert_id])
}

// ============================================
// CENTER SUPPORTING TABLES
// ============================================

model center_addresses {
  id           Int       @id @default(autoincrement())
  center_id    Int?
  address_line String?
  city         String?   @db.VarChar(100)
  state        String?   @db.VarChar(100)
  postal_code  String?   @db.VarChar(20)
  country      String?   @db.VarChar(100)
  latitude     Decimal?  @db.Decimal(9, 6)
  longitude    Decimal?  @db.Decimal(9, 6)
  created_at   DateTime? @default(now()) @db.Timestamp(6)

  center Center? @relation(fields: [center_id], references: [id], onDelete: Cascade)

  @@index([center_id])
}

model center_amenities {
  id        Int     @id @default(autoincrement())
  center_id Int?
  value     String? @db.VarChar(255)

  center Center? @relation(fields: [center_id], references: [id], onDelete: Cascade)

  @@index([center_id])
}

model center_classes {
  id        Int     @id @default(autoincrement())
  center_id Int?
  name      String? @db.VarChar(100)
  time      String? @db.VarChar(50)
  trainer   String? @db.VarChar(100)
  duration  String? @db.VarChar(50)

  center Center? @relation(fields: [center_id], references: [id], onDelete: Cascade)

  @@index([center_id])
}

model center_equipment {
  id        Int     @id @default(autoincrement())
  center_id Int?
  value     String? @db.VarChar(255)

  center Center? @relation(fields: [center_id], references: [id], onDelete: Cascade)

  @@index([center_id])
}

model center_faqs {
  id        Int     @id @default(autoincrement())
  expert_id Int?
  question  String?
  answer    String?

  center Center? @relation(fields: [expert_id], references: [id], onDelete: Cascade)

  @@index([expert_id])
}

model center_images {
  id        Int     @id @default(autoincrement())
  center_id Int?
  image_url String?

  center Center? @relation(fields: [center_id], references: [id], onDelete: Cascade)

  @@index([center_id])
}

model center_pricing {
  id        Int     @id @default(autoincrement())
  center_id Int?
  type      String? @db.VarChar(50)
  price     String? @db.VarChar(50)

  center Center? @relation(fields: [center_id], references: [id], onDelete: Cascade)

  @@index([center_id])
}

model center_reviews {
  id         Int       @id @default(autoincrement())
  center_id  Int
  user_id    Int
  rating     Decimal   @db.Decimal(2, 1)
  review     String?
  created_at DateTime? @default(now()) @db.Timestamp(6)

  center Center @relation(fields: [center_id], references: [id], onDelete: Cascade)

  @@index([center_id])
}

model center_schedule {
  id           Int       @id @default(autoincrement())
  center_id    Int?
  day_of_week  String    @db.VarChar(10)
  is_open      Boolean   @default(false)
  opening_time DateTime? @db.Time(6)
  closing_time DateTime? @db.Time(6)
  created_at   DateTime? @default(now()) @db.Timestamp(6)
  updated_at   DateTime? @default(now()) @db.Timestamp(6)

  center Center? @relation(fields: [center_id], references: [id], onDelete: Cascade)

  @@index([center_id])
}

model center_services {
  id          Int     @id @default(autoincrement())
  center_id   Int?
  name        String? @db.VarChar(100)
  icon        String? @db.VarChar(10)
  description String?

  center Center? @relation(fields: [center_id], references: [id], onDelete: Cascade)

  @@index([center_id])
}

model center_trainers {
  id        Int     @id @default(autoincrement())
  center_id Int?
  name      String? @db.VarChar(100)
  specialty String? @db.VarChar(100)
  bio       String?
  image     String?

  center Center? @relation(fields: [center_id], references: [id], onDelete: Cascade)

  @@index([center_id])
}

model schedules {
  id           Int       @id @default(autoincrement())
  expert_id    Int?
  day_of_week  String    @db.VarChar(10)
  is_open      Boolean   @default(false)
  opening_time DateTime? @db.Time(6)
  closing_time DateTime? @db.Time(6)
  created_at   DateTime? @default(now()) @db.Timestamp(6)
  updated_at   DateTime? @default(now()) @db.Timestamp(6)

  center Center? @relation(fields: [expert_id], references: [id], onDelete: Cascade)

  @@index([expert_id])
}
